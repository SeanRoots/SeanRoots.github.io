<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Never Ending Story</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="bgMusic" loop autoplay>
        <source src="music/theme.mp3" type="audio/mpeg">
    </audio>
    
    <!-- éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
    <div class="music-control">
        <button id="musicToggle">ğŸµ</button>
    </div>

    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="nav-title">A Never Ending Story</h1>
            <ul class="nav-menu">
                <li><a href="#" data-page="home">é¦–é¡µ/í™ˆí˜ì´ì§€</a></li>
                <li><a href="#" data-page="gallery">ç›¸å†Œ/ì•¨ë²”</a></li>
                <li><a href="#" data-page="mainline">æœ¬æ”¯/ê³„ë³´</a></li>
            </ul>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
        <!-- é¦–é¡µ -->
        <section id="home" class="page active">
            <h2>å®¶æ—é¦–é¡µ/í™ˆí˜ì´ì§€</h2>
            
            <!-- å®¶æ—ä»‹ç»åŒºåŸŸ -->
            <div class="family-intro-container">
                <div class="intro-tabs">
                    <button class="tab-button active" onclick="switchIntroTab('cn')">å¼ æ°å®¶æ—å²æ¦‚è¿°</button>
                    <button class="tab-button" onclick="switchIntroTab('kr')">ì¥ì”¨ ê°€ì¡±ì‚¬ ê°œìš”</button>
                </div>
                <div class="intro-content">
                    <div id="intro-cn" class="intro-tab-content active">
                        <p>ä¸ºè¿½å¿†å…ˆäººã€ä¼ æ‰¿å®¶é£ï¼Œç‰¹æ’°æ­¤å®¶æ—å²ç®€è¿°ï¼Œä»¥è®°æˆ‘å¼ æ°äº”ä»£ä¼ æ‰¿ä¹‹è·¯ã€‚</p>

                        <p>å¼ æ°å®¶æ—æºæµå·²éš¾è¯¦è€ƒï¼Œç¬¬ä¸€ä»£å…ˆç¥–äº‹è¿¹å·²æ¹®æ²¡äºå²æœˆï¼Œæ— ä»æŸ¥èµ·ã€‚è‡³ç¬¬äºŒä»£ï¼Œæœ‰ä¸‰å¥³äºŒå­ï¼Œå®¶æ—åˆå…·è§„æ¨¡ã€‚æœ¬æ”¯æ›¾ç¥–çˆ¶æ’è¡Œç¬¬äº”ï¼Œä¸ºå®¶ä¸­å¹¼å­ï¼Œå´ä»¥åšéŸ§ä¹‹å¿—æ’‘èµ·ä¸€æ–¹å®¶ä¸šï¼Œä¸ºäººè±ªæ”¾ä»—ä¹‰ï¼Œæ·±å¾—æ—äººæ•¬é‡ã€‚</p>

                        <p>æ›¾ç¥–çˆ¶å’Œæ›¾ç¥–æ¯è‚²æœ‰ä¸‰å­å››å¥³ï¼Œå­å¥³çš†æˆå®¶ç«‹ä¸šï¼Œå®¶æ—æ¸å…´ã€‚å…¶ä¸­ï¼Œé•¿å­å³æˆ‘çš„ç¥–çˆ¶ï¼Œæ—©å¹´ä¸§æ¯ï¼Œçˆ¶äº²å› å…¬æ®‹ç–¾ï¼Œæ‰¿çˆ¶å¿—ã€æ‹…å®¶è´£ï¼Œä»¥"é•¿å…„ä¸ºçˆ¶"ä¸ºä¿¡æ¡ï¼Œè¾›å‹¤ç…§é¡¾å…„å¦¹ï¼Œç›´åˆ°æˆå®¶ç«‹ä¸šã€‚</p>

                        <p>è‡³ç¬¬å››ä»£ï¼Œäººä¸å…´æ—ºï¼Œç¹è¡åä»£åå››äººï¼ŒéåŠå„è¡Œå„ä¸šã€‚å¦‚ä»Šï¼Œå®¶æ—æˆå‘˜éå¸ƒå»¶è¾¹ã€åŒ—äº¬ã€æ±Ÿè‹ã€ä¸Šæµ·ã€éŸ©å›½ã€ç¾å›½ç­‰åœ°ï¼Œä»äº‹ç€ç»å•†ã€ç®¡ç†ã€æœåŠ¡ã€åŒ»ç–—ç­‰å¤šç§èŒä¸šã€‚</p>

                        <p>å¦‚ä»Šï¼Œå®¶æ—å·²ä¼ è‡³ç¬¬äº”ä»£ï¼Œä»å°å­¦ç”Ÿåˆ°å¤§å­¦ç”Ÿï¼Œå«è‹å¾…æ”¾ï¼Œå°‘å¹´è´Ÿå£®æ°”ï¼Œå¥‹çƒˆè‡ªæœ‰æ—¶ã€‚</p>

                        <p>è™½æ— æ—è°±è¯¦è½½ï¼Œäº¦æ— æ˜¾èµ«åŠŸåï¼Œä½†å¼ æ°å®¶æ—ä»¥å¹³å‡¡ä¹‹èº¯ï¼Œè¡Œæœ´å®ä¹‹é“ï¼Œä»£ä»£ç›¸æ‰¿ï¼Œç”Ÿç”Ÿä¸æ¯ã€‚æ„¿åäººé“­è®°æ ¹æºï¼Œçæƒœäº²æƒ…ï¼Œä¼ æ‰¿å®¶é£ï¼Œå¥‹å‘å‰è¡Œï¼Œä¹¦å†™å±äºæ–°ä¸€ä»£çš„å®¶æ—ç¯‡ç« ã€‚</p>

                        <p>â€”â€” å¼ æ•ˆèµ«  æ•¬æ’° </p>

                    </div>
                    <div id="intro-kr" class="intro-tab-content">
                        <p>ì„ ì¸ì„ ì¶”ëª¨í•˜ê³ , ê°€ë¬¸ì˜ ê³„ìŠ¹ì„ ìœ„í•˜ì—¬ ì´ ê°€ì¡±ì‚¬ë¥¼ ì €ìˆ í•˜ë©°, ìš°ë¦¬ ì¥ì”¨ì˜ 5ëŒ€ ì „ìŠ¹ì˜ ê¸¸ì„ ê¸°ë¡í•˜ì˜€ë‹¤.</p>

                        <p>ì¥ì”¨ ê°€ë¬¸ì˜ ì›ë¥˜ëŠ” ì´ë¯¸ ìì„¸íˆ ì‚´í´ë³´ê¸° ì–´ë ¤ì› ê³ , 1ì„¸ëŒ€ ì„ ì¡°ì˜ ì‚¬ì ì€ ì´ë¯¸ ì„¸ì›”ì— íŒŒë¬»í˜€ ì¡°ì‚¬í•  ê¸¸ì´ ì—†ì—ˆë‹¤. </p>

                        <p>2ì„¸ëŒ€ì— 3ë‚¨ 2ë…€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°€ë¬¸ì€ ì´ˆë³´ì ì¸  ê·œëª¨ë¥¼ ê°–ì¶”ì—ˆë‹¤. ì¦ì¡°ë¶€ëŠ” ì„œì—´ 5ìœ„ë¡œ, ê°•ì¸í•œ ì˜ì§€ë¡œ ê°€ë¬¸ì˜ ìƒê³„ë¥¼ ì§€íƒ±í•˜ì˜€ê³ , ì‚¬ëŒë¨ì´ í˜¸ë°©í•˜ê³  ì˜ë¦¬ë¥¼ ì§€í‚¤ì—¬, í›„ì„¸ì— ë§ì€ ì´ì•¼ê¸°ë¥¼ ë‚¨ê¸°ì˜€ë‹¤.</p>

                        <p>ì¦ì¡°ë¶€ì™€ ì¦ì¡°ëª¨ëŠ” 3ë‚¨ 4ë…€ë¥¼ ë‚³ì•˜ê³ , ìì‹ë“¤ì´ ëª¨ë‘ ê°€ì •ì„ ì´ë£¨ë©° ì§‘ì•ˆì´ ì ì  í¥ì„±í–ˆë‹¤. ê·¸ì¤‘ ì¥ë‚¨ - ë°”ë¡œ ë‚˜ì˜ í• ì•„ë²„ì§€ëŠ” ì¼ì° ì–´ë¨¸ë‹ˆë¥¼ ì—¬ì˜ì˜€ê³ , ì•„ë²„ì§€ê°€  ê³µìƒìœ¼ë¡œ ë¶ˆêµ¬ê°€ ë˜ì—¬, ì¼ì°íˆ ê°€ë¬¸ì˜ ì±…ì„ì„ ì§Šì–´ì¡Œìœ¼ë©° "ë§í˜•ì€ ì•„ë¶€ì§€ì˜ ì—­í• ì„ í•´ì•¼í•œë‹¤"ëŠ” ì‹ ì¡°ë¡œ í˜•ì œìë§¤ë“¤ì´ ê°€ì •ì„ ì´ë£¨ê¸°ê¹Œì§€ ì• ì¨ ëŒë³´ì•˜ë‹¤. </p>

                        <p>ì œ4ëŒ€ì— ì´ë¥´ëŸ¬ í›„ì†ì´ 14ëª…ìœ¼ë¡œ ë²ˆì„±í•˜ì—¬ ê°€ë¬¸ì´ í¥ì„±í•˜ì˜€ìœ¼ë©°, ê° ì—…ì¢…ì— ë„ë¦¬ í¼ì¡Œë‹¤. í˜„ì¬ ê°€ì¡±êµ¬ì„±ì›ì€ ì—°ë³€, ë¶ê²½, ê°•ì†Œ, ìƒí•˜ì´, í•œêµ­, ë¯¸êµ­ ë“±ì§€ì— ë„ë¦¬ í¼ì ¸ ìˆìœ¼ë©° ê²½ì˜, ê´€ë¦¬, ì„œë¹„ìŠ¤, ì˜ë£Œ ë“± ë‹¤ì–‘í•œ ì§ì—…ì— ì¢…ì‚¬í•˜ê³  ìˆë‹¤.</p>

                        <p>í˜„ì¬ ê°€ì¡±ì€ ì´ë¯¸ 5ì„¸ëŒ€ê¹Œì§€ ì „í•´ì¡Œìœ¼ë©°, ì´ˆë“±í•™ìƒì—ì„œ ëŒ€í•™ìƒì— ì´ë¥´ê¸°ê¹Œì§€, í’‹í’‹í•œ ê¸°ìš´ì„ ì•ˆê³  í˜ì°¨ê²Œ ë¹„ì•½í•˜ê¸¸ ì•½ì†í•˜ê³ ìˆë‹¤.</p>

                        <p>ë¹„ë¡ ì¡±ë³´ì— ìƒì„¸íˆ ê¸°ì¬ë˜ì§€ ì•Šì•˜ê³  í˜í˜í•œ ê³µëª…ë„ ì—†ì—ˆì§€ë§Œ, ì¥ì”¨ê°€ë¬¸ì€ í‰ë²”í•˜ê³  ì†Œë°•í•œ ì¸ê°„ì˜ ì°¸ëœë„ë¦¬ë¥¼ ëŒ€ëŒ€ë¡œ ì´ì–´ë°›ì•„ ëŠì„ì—†ì´ ì‚¶ì˜ í„°ì „ì„ ê°€ê¾¸ì–´ì™”ë‹¤.</p>

                        <p>.  í›„ì„¸ ì‚¬ëŒë“¤ì´ ê·¼ì›ì„ ëª…ì‹¬í•˜ê³ , í˜ˆìœ¡ì˜ ì •ì„ ì†Œì¤‘íˆ ì—¬ê¸°ë©°, ê°€í’ì„ ì „ìŠ¹í•˜ê³ , ë¶„ë°œí•˜ì—¬ ìƒˆë¡œìš´ ì„¸ëŒ€ì— ì†í•˜ëŠ” ê°€ì¡±ì˜ ì¥ì„ ì“°ê¸°ë¥¼ ë°”ë€ë‹¤.</p>

                        <p>-- ì¥íš¨í˜  ì˜¬ë¦¼</p>

                    </div>
                </div>
            </div>

            <p class="instruction-text">ç‚¹å‡»å¤´åƒæŸ¥çœ‹äººç‰©ä»‹ç»ï¼Œæ¨ªå‘æ»‘åŠ¨é¡µé¢æŸ¥çœ‹å…¨éƒ¨å†…å®¹</p>
            <p class="instruction-text">ì‚¬ì§„ì„ í´ë¦­í•˜ì—¬ ì¸ë¬¼ì†Œê°œë¥¼ ì—´ëŒí•˜ì„¸ìš”ï¼› ìŠ¤ì™€ì´í”„í•˜ì—¬ ì „ì²´ ì½˜í…ì¸ ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
            <div class="tree-container">
                <div id="homeGenealogyTree" class="family-tree">
                    <!-- æ€»è°±å°†åœ¨é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ˜¾ç¤º -->
                </div>
            </div>
        </section>

        <!-- ç›¸å†Œé¡µé¢ -->
        <section id="gallery" class="page">
            <h2>å®¶æ—ç›¸å†Œ/ê°€ì¡±ì•¨ë²”</h2>
            <!-- æ»šåŠ¨ç›¸å†Œ -->
            <div class="photo-carousel">
                <div class="photo-container">
                    <img id="carouselImage" src="images/picture/scroll/0001.jpg" alt="å®¶æ—ç…§ç‰‡">
                </div>
                <div class="photo-controls">
                    <button onclick="previousPhoto()">â®</button>
                    <span id="photoCounter">1 / 10</span>
                    <button onclick="nextPhoto()">â¯</button>
                </div>
            </div>
            <!-- ç›¸å†Œç½‘æ ¼ -->
            <div class="photo-gallery">
                <div class="gallery-grid" id="photoGrid">
                    <!-- ç›¸å†Œç¼©ç•¥å›¾å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </div>
            </div>
        </section>

        <!-- æ€»è°±é¡µé¢ -->
        <section id="genealogy" class="page">
            <h2>å®¶æ—æ€»è°±/ê°€ì¡±ì´ë³´</h2>
            <p class="instruction-text">ç‚¹å‡»å¤´åƒæŸ¥çœ‹äººç‰©ä»‹ç»ï¼Œæ¨ªå‘æ»‘åŠ¨é¡µé¢æŸ¥çœ‹å…¨éƒ¨å†…å®¹</p>
            <p class="instruction-text">ì‚¬ì§„ì„ í´ë¦­í•˜ì—¬ ì¸ë¬¼ì†Œê°œë¥¼ ì—´ëŒí•˜ì„¸ìš”ï¼› ìŠ¤ì™€ì´í”„í•˜ì—¬ ì „ì²´ ì½˜í…ì¸ ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
            <div class="tree-container">
                <div id="genealogyTree" class="family-tree">
                    <p>ç‚¹å‡»"æ€»è°±"æŒ‰é’®æŸ¥çœ‹å®Œæ•´çš„è°±ç³»</p>
                </div>
            </div>
        </section>

        <!-- æœ¬æ”¯é¡µé¢ -->
        <section id="mainline" class="page">
            <h2>æœ¬æ”¯è°±ç³»/ê°€ì¡±ê³„ë³´</h2>
            <p class="instruction-text">ç‚¹å‡»å¤´åƒæŸ¥çœ‹äººç‰©ä»‹ç»ï¼Œæ¨ªå‘æ»‘åŠ¨é¡µé¢æŸ¥çœ‹å…¨éƒ¨å†…å®¹</p>
            <p class="instruction-text">ì‚¬ì§„ì„ í´ë¦­í•˜ì—¬ ì¸ë¬¼ì†Œê°œë¥¼ ì—´ëŒí•˜ì„¸ìš”ï¼› ìŠ¤ì™€ì´í”„í•˜ì—¬ ì „ì²´ ì½˜í…ì¸ ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
            <div class="tree-container">
                <div id="mainlineTree" class="family-tree">
                    <p>ç‚¹å‡»"æœ¬æ”¯"æŒ‰é’®æŸ¥çœ‹ä¸»è¦æ”¯ç³»çš„è°±ç³»</p>
                </div>
            </div>
        </section>
    </main>

    <!-- äººç‰©è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="personModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="personDetails"></div>
        </div>
    </div>

    <!-- ç›¸å†Œå¤§å›¾é¢„è§ˆæ¨¡æ€æ¡† -->
    <div id="photoModal" class="photo-modal">
        <span class="photo-modal-close" onclick="closePhotoModal()">&times;</span>
        <div class="photo-modal-content">
            <img id="modalImage" class="photo-modal-img" src="" alt="ç…§ç‰‡é¢„è§ˆ">
        </div>
    </div>

    <script>
        // æ­£ç¡®çš„çˆ¶å­å…³ç³»å®¶æ—ç½‘ç«™JavaScript
        console.log('å¼€å§‹åŠ è½½æ­£ç¡®çˆ¶å­å…³ç³»ç‰ˆé¡µé¢...');
        
        // å…¨å±€å˜é‡
        let currentPhotoIndex = 0;
        let familyData = [];
        let musicPlaying = true;
        let isLoading = false;
        
        const photoList = [
            'images/picture/scroll/0001.jpg',
            'images/picture/scroll/0002.jpg',
            'images/picture/scroll/0003.jpg',
            'images/picture/scroll/0004.jpg',
            'images/picture/scroll/0005.jpg',
            'images/picture/scroll/0006.jpg',
            'images/picture/scroll/0007.jpg',
            'images/picture/scroll/0008.jpg',
            'images/picture/scroll/0009.jpg',
            'images/picture/scroll/0025.jpg'
        ];

        const galleryPhotos = [
            'images/picture/all/0011.jpg', 'images/picture/all/0012.jpg', 'images/picture/all/0013.jpg',
            'images/picture/all/0014.jpg', 'images/picture/all/0015.jpg', 'images/picture/all/0016.jpg',
            'images/picture/all/0018.jpg', 'images/picture/all/0019.jpg',
            'images/picture/all/0020.jpg', 'images/picture/all/0021.jpg', 'images/picture/all/0022.jpg',
            'images/picture/all/0023.jpg', 'images/picture/all/0024.jpg', 'images/picture/all/0025.jpg',
            'images/picture/all/0026.jpg', 'images/picture/all/0027.jpg', 'images/picture/all/0028.jpg',
            'images/picture/all/0029.jpg', 'images/picture/all/0031.jpg',
            'images/picture/all/0032.jpg', 'images/picture/all/0033.jpg', 'images/picture/all/0035.jpg',
            'images/picture/all/0036.jpg', 'images/picture/all/0037.jpg', 'images/picture/all/0038.jpg',
            'images/picture/all/0039.jpg', 'images/picture/all/0040.jpg', 
            'images/picture/all/0042.jpg', 'images/picture/all/0043.jpg',
            'images/picture/all/0045.jpg', 'images/picture/all/0046.jpg', 'images/picture/all/0047.jpg',
            'images/picture/all/0048.jpg', 'images/picture/all/0049.jpg', 'images/picture/all/0050.jpg',
            'images/picture/all/29.jpg', 'images/picture/all/39.jpg'
        ];
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            loadFamilyData();
            initializePhotoCarousel();
            initializeGallery();
            initializeMusic();
            initializeNavigation();
            
            // æ·»åŠ ç”¨æˆ·äº¤äº’æ—¶è‡ªåŠ¨æ’­æ”¾éŸ³ä¹
            document.addEventListener('click', function() {
                const audio = document.getElementById('bgMusic');
                if (audio && audio.paused) {
                    audio.play().catch(function(error) {
                        console.log('æ’­æ”¾å¤±è´¥:', error);
                    });
                }
            }, { once: true });
            
            console.log('åˆå§‹åŒ–å®Œæˆ');
        });
        
        // åŠ è½½å®¶æ—æ•°æ®
        async function loadFamilyData() {
            try {
                console.log('å¼€å§‹åŠ è½½å®¶æ—æ•°æ®...');
                const response = await fetch('all-members.json');
                familyData = await response.json();
                console.log('å®¶æ—æ•°æ®åŠ è½½å®Œæˆï¼Œæ ¹æˆå‘˜æ•°é‡:', familyData.length);
                
                // åˆ†ææ•°æ®ç»“æ„
                if (familyData.length > 0) {
                    console.log('ç¬¬ä¸€ä¸ªæ ¹æˆå‘˜:', familyData[0].name);
                    if (familyData[0].children) {
                        console.log('ç¬¬ä¸€ä»£å­å¥³æ•°é‡:', familyData[0].children.length);
                    }
                    
                    // éªŒè¯æ•°æ®ç»“æ„å®Œæ•´æ€§
                    console.log('æ•°æ®ç»“æ„éªŒè¯:');
                    console.log('- æ ¹æˆå‘˜ID:', familyData[0].id);
                    console.log('- æ ¹æˆå‘˜é…å¶:', familyData[0].spouse?.name || 'æ— ');
                    console.log('- æ•°æ®æºå·²æ›´æ–°ï¼Œä½¿ç”¨ä¿®æ­£åçš„å…³è”å…³ç³»');

                    // ç«‹å³åœ¨é¦–é¡µæ˜¾ç¤ºæ€»è°±
                    const homeTree = document.getElementById('homeGenealogyTree');
                    if (homeTree) {
                        console.log('åœ¨é¦–é¡µæ˜¾ç¤ºæ€»è°±...');
                        let allTreesHtml = '<div class="all-roots-container">';
                        familyData.forEach((rootPerson, index) => {
                            console.log(`æ„å»ºç¬¬ ${index + 1} ä¸ªæ ¹æˆå‘˜çš„æ ‘: ${rootPerson.name}`);
                            const treeHtml = buildProperFamilyTree(rootPerson);
                            allTreesHtml += `<div class="root-tree-section">${treeHtml}</div>`;
                        });
                        allTreesHtml += '</div>';
                        homeTree.innerHTML = allTreesHtml;
                    }
                }
            } catch (error) {
                console.error('åŠ è½½å®¶æ—æ•°æ®å¤±è´¥:', error);
            }
        }
        
        // åˆå§‹åŒ–ç›¸å†Œè½®æ’­
        function initializePhotoCarousel() {
            updatePhotoDisplay();
            
            let autoPlayTimer = null;
            let userInteracted = false;
            
            // å¼€å§‹è‡ªåŠ¨æ’­æ”¾
            function startAutoPlay() {
                if (autoPlayTimer) clearInterval(autoPlayTimer);
                autoPlayTimer = setInterval(() => {
                    if (document.getElementById('gallery').classList.contains('active') && !userInteracted) {
                        nextPhoto();
                    }
                }, 5000);
            }
            
            // åœæ­¢è‡ªåŠ¨æ’­æ”¾
            function stopAutoPlay() {
                userInteracted = true;
                if (autoPlayTimer) {
                    clearInterval(autoPlayTimer);
                }
                // 5ç§’åé‡ç½®ç”¨æˆ·äº¤äº’çŠ¶æ€ï¼Œæ¢å¤è‡ªåŠ¨æ’­æ”¾
                setTimeout(() => {
                    userInteracted = false;
                    startAutoPlay();
                }, 5000);
            }
            
            // ç›‘å¬ç”¨æˆ·äº¤äº’
            document.querySelector('.photo-controls').addEventListener('click', stopAutoPlay);
            
            // å¼€å§‹è‡ªåŠ¨æ’­æ”¾
            startAutoPlay();
            
            console.log('ç›¸å†Œè½®æ’­åˆå§‹åŒ–å®Œæˆ');
        }
        
        // æ›´æ–°ç…§ç‰‡æ˜¾ç¤º
        function updatePhotoDisplay() {
            const image = document.getElementById('carouselImage');
            const counter = document.getElementById('photoCounter');
            
            if (image && counter) {
                image.src = photoList[currentPhotoIndex];
                counter.textContent = `${currentPhotoIndex + 1} / ${photoList.length}`;
            }
        }
        
        // ä¸Šä¸€å¼ ç…§ç‰‡
        function previousPhoto() {
            currentPhotoIndex = (currentPhotoIndex - 1 + photoList.length) % photoList.length;
            updatePhotoDisplay();
        }
        
        // ä¸‹ä¸€å¼ ç…§ç‰‡
        function nextPhoto() {
            currentPhotoIndex = (currentPhotoIndex + 1) % photoList.length;
            updatePhotoDisplay();
        }
        
        // åˆå§‹åŒ–éŸ³ä¹
        function initializeMusic() {
            const audio = document.getElementById('bgMusic');
            if (audio) {
                audio.volume = 0.3;
                // å°è¯•è‡ªåŠ¨æ’­æ”¾
                audio.play().catch(function(error) {
                    console.log('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’åæ’­æ”¾');
                });
                console.log('éŸ³ä¹åˆå§‹åŒ–å®Œæˆ');
            }
        }
        
        // åˆ‡æ¢éŸ³ä¹æ’­æ”¾/æš‚åœ
        function toggleMusic() {
            const audio = document.getElementById('bgMusic');
            const button = document.getElementById('musicToggle');
            
            if (audio) {
                if (musicPlaying) {
                    audio.pause();
                    button.textContent = 'ğŸ”‡';
                    musicPlaying = false;
                } else {
                    audio.play();
                    button.textContent = 'ğŸµ';
                    musicPlaying = true;
                }
            }
        }
        
        // åˆå§‹åŒ–å¯¼èˆª
        function initializeNavigation() {
            const navLinks = document.querySelectorAll('.nav-menu a');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    if (pageId) {
                        showPage(pageId);
                    }
                });
            });
            
            // éŸ³ä¹æ§åˆ¶æŒ‰é’®
            const musicToggle = document.getElementById('musicToggle');
            if (musicToggle) {
                musicToggle.addEventListener('click', toggleMusic);
            }
            
            // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†äººç‰©èŠ‚ç‚¹ç‚¹å‡»
            document.addEventListener('click', function(e) {
                const personNode = e.target.closest('.person-node');
                if (personNode) {
                    const personId = parseInt(personNode.getAttribute('data-person-id'));
                    if (personId) {
                        showPersonDetail(personId);
                    }
                }
            });
            
            console.log('å¯¼èˆªåˆå§‹åŒ–å®Œæˆ');
        }
        
        // æ˜¾ç¤ºæŒ‡å®šé¡µé¢
        function showPage(pageId) {
            console.log('åˆ‡æ¢åˆ°é¡µé¢:', pageId);
            
            // éšè—æ‰€æœ‰é¡µé¢
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            // æ˜¾ç¤ºæŒ‡å®šé¡µé¢
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                
                // æ›´æ–°å¯¼èˆªæ æ´»åŠ¨çŠ¶æ€
                const navLinks = document.querySelectorAll('.nav-menu a');
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('data-page') === pageId) {
                        link.classList.add('active');
                    }
                });
                
                // æ ¹æ®é¡µé¢ç±»å‹åŠ è½½ç›¸åº”å†…å®¹
                if (pageId === 'mainline') {
                    loadMainlineTree();
                }
            }
        }
        
        // åŠ è½½æ€»è°±æ ‘å½¢ç»“æ„
        function loadGenealogyTree() {
            if (isLoading || !familyData.length) return;
            isLoading = true;
            
            const container = document.getElementById('genealogyTree');
            if (!container) {
                isLoading = false;
                return;
            }
            
            console.log('å¼€å§‹åŠ è½½æ€»è°±æ ‘...');
            container.innerHTML = '<p>æ­£åœ¨æ„å»ºå®¶æ—æ ‘...</p>';
            
            try {
                // æ„å»ºå®Œæ•´çš„å®¶æ—æ ‘ - æ˜¾ç¤ºæ‰€æœ‰æ ¹æˆå‘˜åŠå…¶åä»£
                console.log(`æ€»å…±æœ‰ ${familyData.length} ä¸ªæ ¹æˆå‘˜`);
                
                let allTreesHtml = '<div class="all-roots-container">';
                
                familyData.forEach((rootPerson, index) => {
                    console.log(`æ„å»ºç¬¬ ${index + 1} ä¸ªæ ¹æˆå‘˜çš„æ ‘: ${rootPerson.name}`);
                    const treeHtml = buildProperFamilyTree(rootPerson);
                    allTreesHtml += `<div class="root-tree-section">${treeHtml}</div>`;
                });
                
                allTreesHtml += '</div>';
                container.innerHTML = allTreesHtml;
                
                console.log('æ€»è°±æ ‘æ„å»ºå®Œæˆ');
            } catch (error) {
                console.error('æ„å»ºæ€»è°±æ ‘å¤±è´¥:', error);
                container.innerHTML = '<p>æ„å»ºå®¶æ—æ ‘æ—¶å‡ºé”™ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</p>';
            }
            
            isLoading = false;
        }
        
        // åŠ è½½æœ¬æ”¯æ ‘å½¢ç»“æ„
        function loadMainlineTree() {
            if (isLoading || !familyData.length) return;
            isLoading = true;
            
            const container = document.getElementById('mainlineTree');
            if (!container) {
                isLoading = false;
                return;
            }
            
            console.log('å¼€å§‹åŠ è½½æœ¬æ”¯æ ‘...');
            container.innerHTML = '<p>æ­£åœ¨æ„å»ºæœ¬æ”¯æ ‘...</p>';
            
            try {
                // åªæ˜¾ç¤ºç¬¬ä¸€ä¸ªæˆå‘˜åŠå…¶åä»£
                const rootPerson = familyData[0];
                const treeHtml = buildProperFamilyTree(rootPerson);
                container.innerHTML = treeHtml;
                
                console.log('æœ¬æ”¯æ ‘æ„å»ºå®Œæˆ');
            } catch (error) {
                console.error('æ„å»ºæœ¬æ”¯æ ‘å¤±è´¥:', error);
                container.innerHTML = '<p>æ„å»ºæœ¬æ”¯æ ‘æ—¶å‡ºé”™ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</p>';
            }
            
            isLoading = false;
        }
        
        // æ„å»ºçœŸæ­£çš„æ ‘å½¢ç»“æ„ï¼ˆçˆ¶æ¯-å­å¥³å‚ç›´å…³ç³»ï¼‰
        function buildProperFamilyTree(rootPerson) {
            if (!rootPerson) return '';
            
            // å…¨å±€è®¿é—®è®°å½•ï¼Œé˜²æ­¢é‡å¤æ˜¾ç¤º
            const globalVisited = new Set();
            
            // é¢„å¤„ç†æ•°æ®ï¼Œå»ºç«‹æ­£ç¡®çš„çˆ¶å­å…³ç³»æ˜ å°„
            function preprocessData() {
                const personMap = new Map();
                const parentChildMap = new Map(); // çˆ¶æ¯ID -> å­å¥³IDæ•°ç»„
                
                console.log('å¼€å§‹é¢„å¤„ç†å®¶æ—æ•°æ®...');
                
                // é€’å½’æ”¶é›†æ‰€æœ‰äººç‰©
                function collectAllPersons(person, visited = new Set(), depth = 0) {
                    if (!person || visited.has(person.id) || depth > 15) {
                        if (depth > 15) console.warn('è¾¾åˆ°æœ€å¤§é€’å½’æ·±åº¦ï¼Œåœæ­¢å¤„ç†');
                        return;
                    }
                    
                    visited.add(person.id);
                    console.log(`å¤„ç†ç¬¬${depth}å±‚äººç‰©: ${person.name} (ID: ${person.id})`);
                    
                    // å­˜å‚¨äººç‰©ä¿¡æ¯
                    if (!personMap.has(person.id)) {
                        personMap.set(person.id, person);
                    }
                    
                    // å¤„ç†å­å¥³å…³ç³»
                    if (person.children && person.children.length > 0) {
                        const childrenIds = [];
                        person.children.forEach(child => {
                            // ç¡®ä¿å­å¥³ä¸æ˜¯é…å¶ï¼Œå¹¶ä¸”æœ‰æœ‰æ•ˆçš„ID
                            if (child && child.id && child.id !== person.spouse?.id) {
                                childrenIds.push(child.id);
                                collectAllPersons(child, visited, depth + 1);
                            }
                        });
                        if (childrenIds.length > 0) {
                            parentChildMap.set(person.id, childrenIds);
                            console.log(`${person.name} çš„å­å¥³: ${childrenIds.length}ä¸ª`);
                        }
                    }
                    
                    // å¤„ç†é…å¶ï¼ˆä¸é€’å½’å¤„ç†é…å¶çš„å­å¥³ï¼Œé¿å…é‡å¤ï¼‰
                    if (person.spouse && person.spouse.id && !visited.has(person.spouse.id)) {
                        visited.add(person.spouse.id);
                        if (!personMap.has(person.spouse.id)) {
                            personMap.set(person.spouse.id, person.spouse);
                            console.log(`æ·»åŠ é…å¶: ${person.spouse.name} (ID: ${person.spouse.id})`);
                        }
                    }
                }
                
                collectAllPersons(rootPerson);
                console.log(`é¢„å¤„ç†å®Œæˆ: å…±æ”¶é›† ${personMap.size} ä¸ªäººç‰©`);
                return { personMap, parentChildMap };
            }
            
            const { personMap, parentChildMap } = preprocessData();
            
            // é€’å½’æ„å»ºæ ‘å½¢èŠ‚ç‚¹
            function buildTreeNode(personId, depth = 0) {
                if (!personId || globalVisited.has(personId) || depth > 12) {
                    if (depth > 12) console.warn(`è¾¾åˆ°æœ€å¤§æ˜¾ç¤ºæ·±åº¦ï¼Œåœæ­¢æ„å»ºèŠ‚ç‚¹: ${personId}`);
                    return '';
                }
                
                const person = personMap.get(personId);
                if (!person) {
                    console.warn(`æœªæ‰¾åˆ°äººç‰©ä¿¡æ¯: ${personId}`);
                    return '';
                }
                
                globalVisited.add(personId);
                console.log(`æ„å»ºç¬¬${depth}å±‚èŠ‚ç‚¹: ${person.name}`);
                
                let html = '<div class="tree-node">';
                
                // æ„å»ºçˆ¶æ¯èŠ‚ç‚¹ï¼ˆå¤«å¦»ï¼‰
                html += '<div class="parents-container">';
                
                if (person.spouse && person.spouse.id && personMap.has(person.spouse.id)) {
                    const spouse = personMap.get(person.spouse.id);
                    html += '<div class="couple-group">';
                    
                    // æ ¹æ®æ€§åˆ«å†³å®šæ˜¾ç¤ºé¡ºåºï¼ˆç”·å·¦å¥³å³ï¼‰
                    if (person.sex === 'ç”·') {
                        html += createPersonNode(person);
                        html += '<div class="marriage-line"></div>';
                        html += createPersonNode(spouse);
                    } else {
                        html += createPersonNode(spouse);
                        html += '<div class="marriage-line"></div>';
                        html += createPersonNode(person);
                    }
                    html += '</div>';
                    
                    // æ ‡è®°é…å¶ä¸ºå·²è®¿é—®
                    globalVisited.add(person.spouse.id);
                    console.log(`å¤«å¦»èŠ‚ç‚¹: ${person.name} â™¥ ${spouse.name}`);
                } else {
                    // å•èº«çˆ¶æ¯
                    html += '<div class="single-parent">';
                    html += createPersonNode(person);
                    html += '</div>';
                    console.log(`å•èº«èŠ‚ç‚¹: ${person.name}`);
                }
                
                html += '</div>';
                
                // å¦‚æœæœ‰å­å¥³ï¼Œæ„å»ºå­å¥³èŠ‚ç‚¹
                const childrenIds = parentChildMap.get(personId);
                if (childrenIds && childrenIds.length > 0) {
                    // è¿‡æ»¤æ‰å·²è®¿é—®çš„å­å¥³
                    const unvisitedChildren = childrenIds.filter(childId => 
                        !globalVisited.has(childId) && personMap.has(childId)
                    );
                    
                    if (unvisitedChildren.length > 0) {
                        html += '<div class="parent-child-connector"></div>';
                        html += '<div class="children-container">';
                        // æ·»åŠ å…„å¼Ÿè¿æ¥çº¿ä½œä¸ºHTMLå…ƒç´ 
                        html += '<div class="sibling-horizontal-line"></div>';
                        
                        // åˆ›å»ºå­å¥³æ°´å¹³å®¹å™¨
                        html += '<div class="siblings-row">';
                        
                        unvisitedChildren.forEach((childId, index) => {
                            // ä¸ºæ¯ä¸ªå­å¥³æ·»åŠ å‚ç›´è¿æ¥çº¿
                            html += '<div class="child-wrapper">';
                            html += '<div class="child-vertical-line"></div>';
                            html += buildTreeNode(childId, depth + 1);
                            html += '</div>';
                        });
                        
                        html += '</div>';
                        html += '</div>';
                    }
                }
                
                html += '</div>';
                return html;
            }
            
            return '<div class="family-tree-wrapper">' + buildTreeNode(rootPerson.id) + '</div>';
        }
        
        // åˆ›å»ºäººç‰©èŠ‚ç‚¹HTML
        function createPersonNode(person) {
            if (!person) return '';
            
            const photo = person.photo || 'images/gallery/default-m.jpg';
            const name = person.name || 'æœªçŸ¥';
            
            return `
                <div class="person-node" data-person-id="${person.id}">
                    <img src="${photo}" alt="${name}" class="person-avatar" onerror="this.src='images/gallery/default-m.jpg'">
                    <div class="person-name">${name}</div>
                </div>
            `;
        }
        
        // æ˜¾ç¤ºäººç‰©è¯¦æƒ…
        function showPersonDetail(personId) {
            const person = findPersonById(personId);
            if (!person) {
                console.log('æœªæ‰¾åˆ°äººç‰©:', personId);
                return;
            }
            
            const modal = document.getElementById('personModal');
            const details = document.getElementById('personDetails');
            
            if (modal && details) {
                details.innerHTML = createPersonDetailHTML(person);
                modal.style.display = 'block';
                console.log('æ˜¾ç¤ºäººç‰©è¯¦æƒ…:', person.name);
            }
        }
        
        // æ ¹æ®IDæŸ¥æ‰¾äººå‘˜
        function findPersonById(id) {
            function searchInPerson(person) {
                if (person.id === id) return person;
                
                if (person.children) {
                    for (let child of person.children) {
                        const found = searchInPerson(child);
                        if (found) return found;
                    }
                }
                
                if (person.spouse) {
                    const found = searchInPerson(person.spouse);
                    if (found) return found;
                }
                
                return null;
            }
            
            for (let person of familyData) {
                const found = searchInPerson(person);
                if (found) return found;
            }
            
            return null;
        }
        
        // åˆ›å»ºäººç‰©è¯¦æƒ…HTML
        function createPersonDetailHTML(person) {
            if (!person) return '';
            
            return `
                <div class="person-detail">
                    <div class="person-detail-header">
                        <div class="person-photo-large">
                            <img src="${person.photo || 'images/gallery/default-m.jpg'}" 
                                alt="${person.name || 'æœªçŸ¥'}" 
                                onerror="this.src='images/gallery/default.png'"
                                class="detail-photo">
                        </div>
                        <div class="person-basic-info">
                            <h3>${person.name || 'æœªçŸ¥'} / ${person.nameKorea || ''}</h3>
                            
                            <div class="basic-info-grid">
                                <div class="detail-row">
                                    <div class="detail-label">å§“å</div>
                                    <div class="detail-value">
                                        <div class="bilingual-text">
                                            <div class="chinese-text">${person.name || 'æœªçŸ¥'}</div>
                                            <div class="korean-text">${person.nameKorea || ''}</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="detail-row">
                                    <div class="detail-label">æ’è¡Œ</div>
                                    <div class="detail-value">ç¬¬${person.order || '?'}ä¸ª</div>
                                </div>
                                
                                <div class="detail-row">
                                    <div class="detail-label">æ€§åˆ«</div>
                                    <div class="detail-value">${person.sex || 'æœªçŸ¥'}</div>
                                </div>
                                
                                <div class="detail-row">
                                    <div class="detail-label">å‡ºç”Ÿæ—¥æœŸ</div>
                                    <div class="detail-value">${person.birth || 'æœªçŸ¥'}</div>
                                </div>
                                
                                <div class="detail-row">
                                    <div class="detail-label">ç¦»ä¸–æ—¥æœŸ</div>
                                    <div class="detail-value">${person.death || 'å¥åœ¨'}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-label">èŒä¸š</div>
                        <div class="detail-value">${person.job || 'æœªçŸ¥'}</div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-label">å±…ä½åœ°</div>
                        <div class="detail-value">${person.residence || 'æœªçŸ¥'}</div>
                    </div>
                    
                    <div class="detail-row">
                        <div class="detail-label">äººç‰©çºªè¦</div>
                        <div class="detail-value">
                            <div class="bilingual-text">
                                <div class="chinese-text">${person.introduce || 'æš‚æ— ä»‹ç»'}</div>
                                <div class="korean-text">${person.introduceKorea || ''}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // åˆå§‹åŒ–ç›¸å†Œ
        function initializeGallery() {
            const photoGrid = document.getElementById('photoGrid');
            if (!photoGrid) return;

            // åˆ›å»ºæ‰€æœ‰ç›¸å†Œç¼©ç•¥å›¾
            galleryPhotos.forEach((photo, index) => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';
                galleryItem.innerHTML = `<img src="${photo}" alt="ç…§ç‰‡ ${index + 1}" loading="lazy">`;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                galleryItem.addEventListener('click', () => {
                    openPhotoModal(photo);
                });
                
                photoGrid.appendChild(galleryItem);
            });
            
            console.log('ç›¸å†Œåˆå§‹åŒ–å®Œæˆ');
        }

        // æ‰“å¼€ç…§ç‰‡é¢„è§ˆæ¨¡æ€æ¡†
        function openPhotoModal(photoSrc) {
            const modal = document.getElementById('photoModal');
            const modalImg = document.getElementById('modalImage');
            if (modal && modalImg) {
                modalImg.src = photoSrc;
                modal.style.display = 'block';
            }
        }

        // å…³é—­ç…§ç‰‡é¢„è§ˆæ¨¡æ€æ¡†
        function closePhotoModal() {
            const modal = document.getElementById('photoModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // å…³é—­äººç‰©è¯¦æƒ…æ¨¡æ€æ¡†
        function closeModal() {
            const modal = document.getElementById('personModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const personModal = document.getElementById('personModal');
            const photoModal = document.getElementById('photoModal');
            
            if (event.target === personModal) {
                closeModal();
            } else if (event.target === photoModal) {
                closePhotoModal();
            }
        }
        
        // é”®ç›˜äº‹ä»¶å¤„ç†
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
                closePhotoModal();
            } else if (event.key === 'ArrowLeft' && document.getElementById('home').classList.contains('active')) {
                previousPhoto();
            } else if (event.key === 'ArrowRight' && document.getElementById('home').classList.contains('active')) {
                nextPhoto();
            }
        });
        
        // è§¦æ‘¸äº‹ä»¶å¤„ç†ï¼ˆç§»åŠ¨ç«¯ï¼‰
        let touchStartX = 0;
        let touchEndX = 0;
        
        document.addEventListener('touchstart', function(event) {
            touchStartX = event.changedTouches[0].screenX;
        });
        
        document.addEventListener('touchend', function(event) {
            touchEndX = event.changedTouches[0].screenX;
            handleSwipe();
        });
        
        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            // åªåœ¨é¦–é¡µè½®æ’­å›¾æ¿€æ´»æ—¶å¤„ç†æ»‘åŠ¨
            if (document.getElementById('home').classList.contains('active') && Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // å·¦æ»‘ï¼Œä¸‹ä¸€å¼ 
                    nextPhoto();
                } else {
                    // å³æ»‘ï¼Œä¸Šä¸€å¼ 
                    previousPhoto();
                }
            }
        }
        
        // åˆ‡æ¢ä»‹ç»æ ‡ç­¾
        function switchIntroTab(lang) {
            // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));
            const activeButton = document.querySelector(`.tab-button[onclick="switchIntroTab('${lang}')"]`);
            if (activeButton) activeButton.classList.add('active');
            
            // åˆ‡æ¢å†…å®¹
            const contents = document.querySelectorAll('.intro-tab-content');
            contents.forEach(content => content.classList.remove('active'));
            const activeContent = document.getElementById(`intro-${lang}`);
            if (activeContent) activeContent.classList.add('active');
        }

        console.log('æ­£ç¡®çˆ¶å­å…³ç³»ç‰ˆé¡µé¢è„šæœ¬åŠ è½½å®Œæˆ');
    </script>
</body>
</html>
